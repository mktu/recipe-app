# よく作る（調理回数カウント）

## ステータス
✅ 完了（方針変更: 閲覧履歴トラッキングに変更）

## 背景・課題

「よく作るレシピ」を自動で浮かび上がらせるために、調理回数のカウントが必要。
使えば使うほど自分の鉄板レシピが可視化される仕組みを作りたい。

## 実装された方針（変更後）

「作ったかどうか」は計測が難しいため、**「見た」を確実に計測する方針**に転換。
アプリで見た = 作る候補として検討した、という前提で十分な代替になると判断。

### 実装内容

- `view_count` / `last_viewed_at` は recipes テーブルに既存カラムとして存在
- `POST /api/track/recipe/[id]` — LIFF のカードクリック時に閲覧記録
- `GET /api/track/recipe/[id]` — LINE カードタップ時に記録 + 元サイトにリダイレクト
- LINE キーワード「最近見た」→ `last_viewed_at DESC` でレシピ返却
- LINE キーワード「よく見る」→ `view_count DESC` でレシピ返却

### 当初案との比較

| 項目 | 当初案 | 実装案 |
|------|--------|--------|
| カラム | `cook_count`, `last_cooked_at` | `view_count`, `last_viewed_at`（既存） |
| トリガー | 「作った！」ボタン | カード/レシピページ閲覧 |
| DBマイグレーション | 必要 | 不要 |

## 関連エピック

- [探す体験の改善（クイックリプライ）](./search-ux.md) - 「最近見た」「よく見る」選択肢の追加余地あり

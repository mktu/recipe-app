# ã‚»ãƒƒã‚·ãƒ§ãƒ³å¼•ãç¶™ã

## æœ€çµ‚æ›´æ–°
2026-02-28 (ææ–™å°‘ãªã‚ã‚«ãƒ¼ãƒ‰æ”¹å–„ãƒ»ingredients_raw ãƒã‚°ä¿®æ­£ãƒ»staging ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«å®Œäº†)

## ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º
ãƒ•ã‚§ãƒ¼ã‚º 3ï¼šLINE Messaging API é€£æº - **ä¸€èˆ¬å…¬é–‹æº–å‚™å®Œäº†**

## ç›´è¿‘ã®å®Œäº†ã‚¿ã‚¹ã‚¯
- [x] **ææ–™å°‘ãªã‚ã‚«ãƒ¼ãƒ‰æ”¹å–„ï¼ˆPR #15ï¼‰**
  - å„ã‚«ãƒ¼ãƒ‰ã«ã€Œææ–™ Xå“ã€ã‚’ã‚¢ãƒ³ãƒãƒ¼è‰²ã§è¡¨ç¤º
  - ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã€ŒğŸ“¦ ææ–™Xå“ä»¥ä¸‹ã®ãƒ¬ã‚·ãƒ”ã«çµã‚Šã¾ã—ãŸï¼ã€ã«å¤‰æ›´
  - SQL RPC ã« `ingredient_count` ã‚’è¿½åŠ ï¼ˆ`ingredients_raw IS NOT NULL` ã®ã¿å¯¾è±¡ï¼‰
  - DBå‹å®šç¾©ã‚’å†ç”Ÿæˆ
- [x] **ingredients_raw ä¿å­˜ãƒã‚°ä¿®æ­£**
  - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ãŒå–å¾—ã—ãŸé£Ÿææƒ…å ±ãŒ DB ã«ä¿å­˜ã•ã‚Œã¦ã„ãªã‹ã£ãŸæ ¹æœ¬åŸå› ã‚’ä¿®æ­£
  - `ParsedRecipe` / `CreateRecipeInput` ã« `ingredientsRaw` ã‚’è¿½åŠ ã—å…¨çµŒè·¯ï¼ˆLINE botãƒ»Web ã‚¢ãƒ—ãƒªï¼‰ã§ä¿å­˜
- [x] **staging ã®æ—¢å­˜20ä»¶ã‚’ ingredients_raw ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«**
  - ä¸€æ™‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å…¨20ä»¶ã‚’å†ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ— â†’ å…¨ä»¶æˆåŠŸï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ç”¨é€”ã‚’æœãŸã—å‰Šé™¤ï¼‰
- [x] **view_count ãŒè¨˜éŒ²ã•ã‚Œãªã„ãƒã‚°ä¿®æ­£**ï¼ˆå‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

## é€²è¡Œä¸­ã®ã‚¿ã‚¹ã‚¯
ï¼ˆãªã—ï¼‰

## æ¬¡ã«ã‚„ã‚‹ã“ã¨ï¼ˆå„ªå…ˆåº¦é †ï¼‰
- [ ] **LINE å®Ÿæ©Ÿç¢ºèª**ï¼ˆææ–™å°‘ãªã‚ã‚«ãƒ¼ãƒ‰ã®è¦‹ãŸç›®ãƒ»å“æ•°ãƒãƒƒã‚¸ç¢ºèªï¼‰
- [ ] **æœ¬ç•ªç’°å¢ƒã® Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
  - **æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆNortheast Asia - Tokyoï¼‰ã§ä½œæˆã™ã‚‹ã“ã¨**
- [ ] **æœ¬ç•ªç’°å¢ƒã®åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒå‡¦ç†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
  - `docs/EMBEDDING_BATCH_SETUP.md` ã«æ²¿ã£ã¦è¨­å®š
- [ ] **OGP ç”»åƒã®ä½œæˆ**ï¼ˆ1200Ã—630pxï¼‰

## ä¿ç•™ã‚¨ãƒ”ãƒƒã‚¯
- ãŠæ°—ã«å…¥ã‚Šï¼ˆfavorites.mdï¼‰- ã€Œã‚ˆãè¦‹ã‚‹ã€ã¨å½¹å‰²ãŒè¢«ã‚‹ãŸã‚ä¿ç•™

## æ¤œè¨äº‹é …ï¼ˆæ¬¡å›ä»¥é™ï¼‰
- `preview:flex` ã« `| pbcopy` ã‚’è¿½åŠ ã—ã¦ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è‡ªå‹•ã‚³ãƒ”ãƒ¼ã«ã™ã‚‹ï¼ˆå°æ”¹å–„ï¼‰

## å°†æ¥ã®æ”¹å–„æ¡ˆï¼ˆå®Ÿè£…ä¿ç•™ï¼‰
- **æ¤œç´¢ãƒ­ã‚°ã®è“„ç©** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¤œç´¢å…¥åŠ›ã‚’è¨˜éŒ²ã—ã¦åˆ†æã«æ´»ç”¨
- **åŸ‹ã‚è¾¼ã¿ã«é£Ÿææƒ…å ±ã‚’å«ã‚ã‚‹** - ã‚¿ã‚¤ãƒˆãƒ«+é£Ÿæã§ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
- **ingredients_raw ã® amount ã‚’æ­£ã—ããƒ‘ãƒ¼ã‚¹** - ç¾çŠ¶ã¯ name ã«é‡ã‚‚å«ã‚€æ–‡å­—åˆ—ã§ amount ã¯ç©ºã€‚JSON-LD ã® recipeIngredient ã‹ã‚‰é‡ã¨åå‰ã‚’åˆ†é›¢ã™ã‚‹æ”¹å–„

## ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ãƒ»æ³¨æ„ç‚¹
- **NEXT_PUBLIC_APP_URL**: Vercel ã®ç’°å¢ƒå¤‰æ•°è¨­å®šæ¸ˆã¿ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã¯ `.env.local` ã« `http://localhost:3000`
- **Edge Functions ã® JWT æ¤œè¨¼:**
  - `config.toml` ã§ `verify_jwt = false` ã‚’è¨­å®šæ¸ˆã¿
  - CI ã‹ã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã§è‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã‚‹
- **é£Ÿæã‚¨ã‚¤ãƒªã‚¢ã‚¹è‡ªå‹•ç”Ÿæˆ:**
  - åˆå›ç™»éŒ²æ™‚ã¯æœªãƒãƒƒãƒã®ã¾ã¾ï¼ˆç¿Œæ—¥ä»¥é™ã®ãƒãƒƒãƒã§è£œå®Œï¼‰
  - Edge Function ã¯éåŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ202 Accepted ã‚’å³åº§ã«è¿”ã™ï¼‰
  - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ: `npx tsx scripts/auto-alias.ts --dry-run`
- **Edge Function é–‹ç™º:**
  - å…±æœ‰ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´å¾Œã¯ `npm run functions:build` ã‚’å®Ÿè¡Œ
  - è©³ç´°ã¯ `docs/EDGE_FUNCTIONS.md` ã‚’å‚ç…§
- **LIFF èªè¨¼:**
  - LINE Login ãƒãƒ£ãƒãƒ«ã¯ã€Œå…¬é–‹æ¸ˆã¿ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¿…è¦
  - LIFF SDK ã«ã¯è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãŒãªã„
- **ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢é–¾å€¤:** 0.75 ã«è¨­å®šæ¸ˆã¿
- **åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒå‡¦ç†:**
  - ãƒ¬ã‚·ãƒ”ç™»éŒ²æ™‚ã¯ `title_embedding = NULL` ã§ä¿å­˜ã•ã‚Œã‚‹
  - 5åˆ†æ¯ã« Edge Function ãŒåŸ‹ã‚è¾¼ã¿ã‚’ç”Ÿæˆ
- **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º:** `.env.local` ã® `NEXT_PUBLIC_LIFF_ID` ã‚’ç©ºã«ã™ã‚‹ã¨ LINE ãƒ­ã‚°ã‚¤ãƒ³ãªã—ã§å‹•ä½œ
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã¯ `supabase start` ã§èµ·å‹•ãŒå¿…è¦
- **DB å‹æ›´æ–°æ™‚:** `supabase gen types typescript --local > src/types/database.ts` ã‚’å®Ÿè¡Œï¼ˆå…ˆé ­è¡Œã®ä¸è¦ãªå‡ºåŠ›ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ï¼‰
- **GitHub Secrets:** `SUPABASE_ACCESS_TOKEN` ã¨ `SUPABASE_PROJECT_REF` ãŒå¿…è¦ï¼ˆCI ç”¨ï¼‰

## ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ï¼ˆç›´è¿‘ï¼‰
```
4f38e3f docs: SESSION.md ã‚’æ›´æ–°
800cc39 fix: ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã« ingredientsRaw ã‚’è¿½åŠ 
99896df fix: ingredients_raw ã‚’ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’ä¿®æ­£
96ee173 docs: SESSION.md ã‚’æ›´æ–°ï¼ˆPR #15 å®Œäº†ï¼‰
93459c8 Merge pull request #15 from mktu/feature/improve-few-ingredients-card
```

## GitHubãƒªãƒã‚¸ãƒˆãƒª
https://github.com/mktu/recipe-app

## å‚ç…§ã™ã¹ããƒ•ã‚¡ã‚¤ãƒ«
- `requirements.md` - ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆè¦ä»¶ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ»æ©Ÿèƒ½è¦ä»¶ï¼‰
- `CLAUDE.md` - é–‹ç™ºãƒ«ãƒ¼ãƒ«ãƒ»ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚¹ã‚­ãƒ«
- `docs/ARCHITECTURE.md` - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“åƒãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
- `docs/backlogs/README.md` - ã‚¨ãƒ”ãƒƒã‚¯ä¸€è¦§
- `src/lib/line/category-handler.ts` - ã‚«ãƒ†ã‚´ãƒªé¸æŠ Quick Reply ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ææ–™å°‘ãªã‚ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- `src/lib/line/flex-message.ts` - Flex Message ç”Ÿæˆï¼ˆRecipeCardDataãƒ»ingredientCount ãƒãƒƒã‚¸ï¼‰
- `src/lib/line/search-recipes.ts` - ãƒ¬ã‚·ãƒ”æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆfetchFewIngredientsForBotï¼‰
- `src/lib/recipe/parse-recipe.ts` - ãƒ¬ã‚·ãƒ”è§£æï¼ˆingredientsRaw ã‚’ ParsedRecipe ã«å«ã‚€ï¼‰
- `src/lib/db/queries/recipes.ts` - ãƒ¬ã‚·ãƒ”ä½œæˆã‚¯ã‚¨ãƒªï¼ˆingredients_raw ä¿å­˜ï¼‰
- `src/types/recipe.ts` - ParsedRecipe / CreateRecipeInput å‹å®šç¾©
- `supabase/migrations/20260228000000_update_few_ingredients_rpc.sql` - ææ–™å°‘ãªã‚ RPC æ›´æ–°

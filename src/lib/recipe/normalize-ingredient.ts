/**
 * 食材名の正規化
 * JSON-LDやレシピサイトから取得した食材名から、分量・単位・調理用語・ブランド名を除去する
 */

/**
 * 除去対象のブランド名リスト
 * 調味料・食品メーカー名など、食材マッチングの邪魔になるものを列挙
 */
const BRAND_NAMES = [
  // 醤油・みりん系
  'キッコーマン',
  'ヤマサ',
  'マンジョウ',
  'ヒゲタ',
  // 調味料全般
  'ミツカン',
  '味の素',
  'ハウス',
  'エスビー',
  'S&B',
  // ソース・ケチャップ系
  'カゴメ',
  'デルモンテ',
  'ブルドック',
  'オタフク',
  // マヨネーズ・ドレッシング系
  'キユーピー',
  'キューピー',
  // 味噌・だし系
  'マルコメ',
  'ほんだし',
  // 油・その他
  '日清',
  'J-オイルミルズ',
]

/**
 * 食材名から分量・単位・調理用語・ブランド名を除去して正規化する
 *
 * @example
 * normalizeIngredientName('豚肉細切れ 200g') // → '豚肉細切れ'
 * normalizeIngredientName('なす 2本') // → 'なす'
 * normalizeIngredientName('塩 少々') // → '塩'
 * normalizeIngredientName('鶏もも肉（皮なし） 300g') // → '鶏もも肉皮なし'
 * normalizeIngredientName('キッコーマン醤油') // → '醤油'
 * normalizeIngredientName('マンジョウ本みりん') // → '本みりん'
 */
export function normalizeIngredientName(raw: string): string {
  // ブランド名除去用の正規表現を構築
  const brandPattern = new RegExp(BRAND_NAMES.join('|'), 'g')

  return (
    raw
      // ブランド名の除去（例: キッコーマン醤油 → 醤油）
      .replace(brandPattern, '')
      // 数量・単位パターンの除去（スペースなしの確実なもののみ）
      // 例: 200g, 2本, 1/2個 など
      // 注: 玉・株・房など食材名の一部になりやすいものは除外
      .replace(
        /[\d０-９\.\/〜～約]+[gGmlMLcmkgKGℓ個本切れ枚丁束袋パック合片かけ杯尾匹人分]+/g,
        ''
      )
      // 括弧とその中身は保持しつつ括弧記号のみ除去（例: （皮なし）→ 皮なし）
      .replace(/[（()）]/g, '')
      // その他の括弧記号を除去
      .replace(/[【】\[\]「」『』]/g, '')
      // 調理用語・分量表現の除去
      .replace(
        /少々|適量|お好みで|大さじ|小さじ|カップ|ひとつまみ|適宜|ひとかけ|少量|たっぷり|お好み|to taste/gi,
        ''
      )
      // 孤立した数字を除去（例: 「醤油 1」→「醤油」）
      .replace(/\s+[\d０-９\.\/]+$/g, '')
      .replace(/^[\d０-９\.\/]+\s+/g, '')
      // 複数の空白を1つに
      .replace(/\s+/g, ' ')
      // 前後の空白を除去
      .trim()
  )
}
